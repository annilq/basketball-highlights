# 实现篮球投篮检测视频集锦功能

## 需求分析

用户需要实现以下功能：

1. 使用检测的投篮结果，记录当前进球的时间帧
2. 利用进球时间帧通过现有工具(opencv或者ffmpeg)生成进球瞬间视频
3. 可以合并所有进球视频为一个视频集锦

## 现有功能分析

- `ShotDetector` 类已经实现了投篮检测功能，可以判断是否进球
- `ShotDetectorAPI` 类已经实现了 `detect_shots` 方法，返回投篮统计数据和投篮事件
- 投篮事件中已经包含了 `frame` 字段，记录了投篮发生的帧号
- 项目已经使用了OpenCV库进行视频处理

## 实现方案

### 1. 为 `ShotDetectorAPI` 类添加方法

#### `generate_shot_clip` 方法

- **功能**：根据视频路径和帧号生成进球瞬间视频
- **参数**：
  - `video_path`：原始视频路径
  - `shot_frame`：进球帧号
  - `duration`：视频片段时长（秒），默认3秒
  - `output_path`：输出视频路径
- **实现**：
  - 使用OpenCV读取视频
  - 计算起始和结束帧号
  - 截取视频片段并保存

#### `generate_highlights` 方法

- **功能**：合并多个进球视频为一个集锦
- **参数**：
  - `clip_paths`：进球视频片段路径列表
  - `output_path`：输出集锦视频路径
- **实现**：
  - 使用OpenCV读取所有视频片段
  - 按顺序合并视频片段
  - 保存合并后的视频

### 2. 更新 API 接口

在 `app.py` 中添加新的端点：

- `/generate-shot-clip`：生成单个进球视频片段
- `/generate-highlights`：生成进球集锦视频

### 3. 技术实现细节

- 使用OpenCV的 `VideoCapture` 和 `VideoWriter` 类处理视频
- 计算视频的帧率，确保时间计算准确
- 处理视频编码和格式，确保输出视频质量
- 提供错误处理，确保API的稳定性

## 预期结果

- 用户可以通过API检测投篮并获取进球帧号
- 用户可以生成单个进球的视频片段
- 用户可以将多个进球视频合并为一个集锦
- 所有功能都通过API接口提供，方便前端调用
