# 集成篮球进球检测功能计划

## 分析

当前项目是一个基于Bun的monorepo，包含多个应用：

- `api` (Cloudflare Worker) - 后端API服务
- `app` (React应用) - 前端应用
- `web` (Astro网站) - 营销网站
- `email` - 邮件服务

开源项目 `AI-Basketball-Shot-Detection-Tracker` 使用 Python + YOLOv8 + OpenCV 实现篮球进球检测，技术栈与当前项目不同。

## 集成方案

### 方案1：独立Python服务 + API集成（推荐）

1. **创建独立的Python服务**
   - 在 `apps/` 目录下创建 `shot-detector` 目录
   - 复制开源项目的核心文件：`shot_detector.py`、`utils.py`、`best.pt` 等
   - 创建 `requirements.txt` 和 `Dockerfile`
   - 实现RESTful API接口用于接收视频并返回检测结果

2. **API服务集成**
   - 在 `apps/api` 中添加新的路由 `shot-detection`
   - 实现调用Python服务的逻辑
   - 添加文件上传功能

3. **前端应用集成**
   - 在 `apps/app` 中添加视频上传和进球检测界面
   - 实现与API的通信
   - 显示检测结果和剪辑功能

4. **存储和处理**
   - 使用R2存储桶存储上传的视频和生成的剪辑
   - 实现视频处理队列（可选）

## 实施步骤

1. **准备工作**
   - 克隆开源项目代码
   - 测试预训练模型的性能

2. **创建Python服务**
   - 搭建基础服务架构
   - 实现视频处理API
   - 测试本地运行

3. **部署Python服务**
   - 配置Docker容器
   - 部署到GCP Cloud Run或类似服务

4. **集成到主项目**
   - 更新API服务
   - 实现前端界面
   - 测试端到端流程

5. **优化和测试**
   - 性能优化
   - 错误处理
   - 用户体验改进

## 技术依赖

- **新增依赖**：
  - Python 3.8+
  - ultralytics (YOLOv8)
  - OpenCV
  - FastAPI (Python服务)
  - Pydantic
  - Pillow

- **现有依赖**：
  - Cloudflare R2 (存储)
  - Hono (API路由)
  - React (前端)

## 预期功能

- 视频上传和处理
- 实时/批量进球检测
- 自动剪辑进球片段
- 检测结果可视化
- 历史检测记录管理
